---
title: Setting Up Auth
description: Components
---

## Intro
This Auth setup is written around the default Home Assitant OAuth flow.

TODO: Add shadcn reg install instructs

## Step 1: Environment Variables
Set the Environment variables to match your home assistant config
```
# Example Home Assistant host + port
NEXT_PUBLIC_HA_URL=homeassistant.local
NEXT_PUBLIC_HA_PORT=8123
```
Then set your local testing environmental paths
- Point `NEXT_PUBLIC_HA_CLIENT_ID` to your host 
- Point `NEXT_PUBLIC_HA_REDIRECT_URI` to your callback path (This will be setup in a later step)
```
# Example OAuth2 client info
NEXT_PUBLIC_HA_CLIENT_ID=http://localhost:3000
NEXT_PUBLIC_HA_REDIRECT_URI=http://localhost:3000/auth/callback
```

For testing, you can set a Long-lived access token, which will override any OAuth flow.
```
NEXT_PUBLIC_HA_LONG_LIVED_TOKEN="your_token_here"
```
<Callout type="error">
  Using a long-lived token in production is not recommended.
</Callout>

## Step 2: HA Provider
In layout.tsx, wrap children with HomeAssistantProvider.
This allows pages with the applied layout access the global websocket connection.
```jsx
    return (
        <div className="flex flex-col min-h-screen">
            <HomeAssistantProvider>{children}</HomeAssistantProvider>
        </div>
    );
```

## Step 3: Handle Auth callback
Create a page to create the route to handle the callback from Home Assistant:\
This is the final step in the OAuth flow and will redirected to a path if specified.\
Additionally, if you have not set your `NEXT_PUBLIC_HA_REDIRECT_URI` env variable, set it with the newly created route.

#### e.g. `app/auth/callback/page.tsx`
```jsx
"use client";

import { useEffect } from "react";
import { exchangeCodeForToken } from "@/lib/haAuth";
import { useRouter, useSearchParams } from "next/navigation";

export default function AuthCallback() {
  const router = useRouter();
  const params = useSearchParams();

  useEffect(() => {
    const code = params.get("code");
    if (code) {
      exchangeCodeForToken(code).then(() => {
        router.push("/"); // Set path to be redirected to
      });
    }
  }, [params, router]);

  return <p>Completing login...</p>;
}
```

## Conclusion
If this is set up properly, then all components which require Auth will connect automatically to the global websocket.

