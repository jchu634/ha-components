---
title: Auth
description: Setting up Auth for HA API access.
---

## Intro
This Auth setup is written around the default Home Assistant OAuth flow.

<Tabs items={['npm', 'pnpm', 'yarn', 'bun']}>
  <Tab value="npm">    
    ```bash
    npx shadcn@latest add https://hacomponents.keshuac.com/r/auth.json
    ```
  </Tab>
  <Tab value="pnpm">
    ```bash
    pnpm dlx shadcn@latest add https://hacomponents.keshuac.com/r/auth.json
    ```
  </Tab>
  <Tab value="yarn">
    ```bash
    yarn shadcn@latest add https://hacomponents.keshuac.com/r/auth.json
    ```
  </Tab>
  <Tab value="bun">
    ```bash
    bunx --bun shadcn@latest add https://hacomponents.keshuac.com/r/auth.json
    ```
  </Tab>
</Tabs>

## Step 1: Environment Variables
Set the Environment variables to match your home assistant config
```
# Example Home Assistant host + port
NEXT_PUBLIC_HA_URL=homeassistant.local
NEXT_PUBLIC_HA_PORT=8123
```
Then set your local testing environmental paths
- Point `NEXT_PUBLIC_HA_CLIENT_ID` to your host 
- Point `NEXT_PUBLIC_HA_REDIRECT_URI` to your callback path (This will be setup in a later step)
```
# Example OAuth2 client info
NEXT_PUBLIC_HA_CLIENT_ID=http://localhost:3000
NEXT_PUBLIC_HA_REDIRECT_URI=http://localhost:3000/auth/callback
```

For testing, you can set a Long-lived access token, which will override any OAuth flow.
```
NEXT_PUBLIC_HA_LONG_LIVED_TOKEN="your_token_here"
```
<Callout type="error">
  Using a long-lived token in production is not recommended.
</Callout>

## Step 2: HA Provider
In layout.tsx, wrap children with HomeAssistantProvider.
This allows pages with the applied layout access the global websocket connection.
```jsx
    return (
        <div className="flex flex-col min-h-screen">
            <HomeAssistantProvider>{children}</HomeAssistantProvider>
        </div>
    );
```

## Step 3: Handle Auth callback
Create a page to create the route to handle the callback from Home Assistant:\
This is the final step in the OAuth flow and will redirected to a path if specified.\
Additionally, if you have not set your `NEXT_PUBLIC_HA_REDIRECT_URI` env variable, set it with the newly created route.

#### e.g. `app/auth/callback/page.tsx`
```jsx
"use client";

import { Suspense } from "react";
import AuthCallback from "@/components/ha-ui/auth/authCallback";

export default function Page() {
    return (
        <Suspense fallback={<p>Loading...</p>}>
            <AuthCallback />
        </Suspense>
    );
}
```

## Conclusion
If this is set up properly, then all components which require Auth will connect automatically to the global websocket.

If you came here from the installation instructions and want to go to the next step: [click here](/docs/installation/installation#step-4-setup-type-generation)
