---
title: Create Your Own
description: Creating your own components.
---

## About
Most components in HA-Components are functionally built around the `haWebsocket` lib, which provides a shared websocket adapter to interact with HA via the websocket api.\
This doc acts as documentation if you want to use its capabilities to build your own components.

## Pre-Requisites
To utilise these APIs, you must have [Auth](docs/installation/auth) set-up.

Additionally, import `haWebSocket`.
```jsx
import { haWebSocket } from "@/lib/haWebsocket";
```

## API

### Controlling Entities
Services are the primary way to control HA entities.\
See docs [here](https://data.home-assistant.io/docs/services/)

For controlling entities use `haWebSocket.callService`

<Tabs items={['Generic', 'Example']}>
  <Tab value="Generic">    
    ``` jsx
    haWebSocket.callService(
        domain,
        service,
        {   // Service Data
            entity_id: entityNameGoesHere
        }
    )
    ```
  </Tab>
  <Tab value="Example">
    Example from [`Light`](https://github.com/jchu634/ha-components/blob/main/components/ha-ui/light.tsx) Component
    ``` jsx
    haWebSocket.callService(
        "light", 
        "turn_on", 
        {
            entity_id: entity,
            rgb_color: rgb,
        }
    );
    ```
  </Tab>
</Tabs>

### Controlling Entities with Returned Data
Some services return data, for those services use `haWebSocket.callServiceWithResponse`

<Tabs items={['Generic', 'Example']}>
  <Tab value="Generic">    
    ``` jsx
    haWebSocket
        .callServiceWithResponse("domain", "service", {
            entity_id: entity,
        })
        .then((response) => {
            console.log("Response: ", response);
        })
        .catch((error) => {
            console.error("Service call failed:", error);
        });
    ```
  </Tab>
  <Tab value="Example">
    Example from [`Weather`](https://github.com/jchu634/ha-components/blob/main/components/ha-ui/Weather.tsx) Component
    ``` jsx
    haWebSocket
            .callServiceWithResponse("weather", "get_forecasts", {
                entity_id: entity,
                type: forecastType,
            })
            .then((response) => {
                setForecasts(response?.response?.[entity]?.forecast);
            })
            .catch((error) => {
                console.error("Service call failed:", error);
            });
    ```
  </Tab>
</Tabs>


### Fetching Entity State
For getting the current state of an entity, 
use `getState`
<Tabs items={['Generic', 'Example']}>
  <Tab value="Generic">    
    ``` jsx
    haWebSocket.getState(entity).then((data) => {
        if (data) {
            // Data State Operations
        }
    });
    ```

  </Tab>
  <Tab value="Example">
    Example from [`toggle`](https://github.com/jchu634/ha-components/blob/main/components/ha-ui/toggle.tsx) component
    ``` jsx
    haWebSocket.getState("light.demo_light").then((data) => {
        if (data) {
            setMonitoredState(data.state === "on");
        }
    });
    ```
  </Tab>
</Tabs>

### Subscribing to State Updates

<Tabs items={['Generic', 'Example']}>
  <Tab value="Generic">    
    ```jsx
    haWebSocket.addStateListener(entity, handler);
    haWebSocket.removeStateListener(entity, handler);
    ```
  </Tab>
  <Tab value="Example">
    Example from [`toggle`](https://github.com/jchu634/ha-components/blob/main/components/ha-ui/toggle.tsx) component
    ```jsx
    useEffect(() => {
        // Subscribe to state updates
        const handler = (newState: any) => {
            setMonitoredState(newState.state === "on");
        };
        haWebSocket.addStateListener(entity, handler);

        return () => haWebSocket.removeStateListener(entity, handler);
    }, [entity]);
    ```
  </Tab>
</Tabs>

## Exception: Camera
The camera component does not utilise `haWebSocket` nor does it require Auth.\
This is because it doesn't touch the HA apis at all, it directly accesses the HA internally hosted Go2RTC server.\
If you want to write your own camera component, you will need to use the `video-rtc` lib instead.
<Tabs items={['Generic', 'Example']}>
  <Tab value="Generic">    
    ```jsx
    import { useWebRTCVideo } from "@/lib/video-rtc";

    const camera = useWebRTCVideo({
        wsSrc: wsURL 
        retryDelay: retryDelay,
        maxRetryAttempts: maxRetryAttempts,
        video: videoProps,
    });
    ```
  </Tab>
  <Tab value="Example">
    Example from [`camera`](https://github.com/jchu634/ha-components/blob/main/components/ha-ui/camera.tsx) component
    ```jsx
    import { useWebRTCVideo } from "@/lib/video-rtc";

    const camera = useWebRTCVideo({
        wsSrc: wsURL || `ws://${process.env.NEXT_PUBLIC_HA_URL}:11984/api/ws?src=${entity}`,
        ...(proxyURL ? { proxy: proxyURL } : {}),
        retryDelay: 5000, // retry every 5s
        maxRetryAttempts: 10,
        video: { autoPlay: true, muted: true, controls: false, tabIndex: -1 },
    });
        ...
    <video
        slot="media"
        {...camera.videoProps}
        className={aspectRatioMap[aspectRatio]}
    />

    ```
  </Tab>
</Tabs>
